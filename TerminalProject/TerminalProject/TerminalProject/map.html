<!doctype html>
<html lang="zh-CN">
<head>
        <!-- 原始地址：//webapi.amap.com/ui/1.0/ui/overlay/SimpleMarker/examples/custom-icon.html -->
       
		<meta charset="utf-8">
		<script src="D:/project/TerminalProject/TerminalProject/TerminalProject/data.js"></script>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>高速公路应急救援系统展示</title>
		<style>
				html,
				body,
				#container {
					margin: 0px; width: 100%; height: 100% 
				}
				.custom-content-marker {
					position: relative;
					width: 25px;
					height: 34px;
				}

				.custom-content-marker img {
					width: 100%;
					height: 100%;
				}
		</style>
		<title>地图加载完成</title>
		
</head>
<body>
<div class="input-card">
	 <h4>左击获取经纬度：</h4>
	<div class="input-item">
	  <input type="text" readonly="true" id="lnglat">
	  <input type="text" readonly="true" id="lnglat">
	</div>
</div>
<div id="container" class="map"></div>
<script src="https://webapi.amap.com/maps?v=1.4.15&key=ce4203c448e716d8434289ffc2c7a6d6&plugin=Map3D,AMap.DistrictSearch,AMap.Autocomplete"></script>
<script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
<script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
<script type="text/javascript" src="D:/project/TerminalProject/TerminalProject/TerminalProject/qwebchannel.js"></script>
 <!-- UI组件库 1.0 -->
<script src="https://webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
<script>
		var map = new AMap.Map('container', {
			
				resizeEnable: true, //是否监控地图容器尺寸变化
				zooms:[8,13], //地图的缩放层次
	            center: [107.53172,29.866258], //初始化地图中心点
	            viewMode: '2D',
	            labelzIndex: 130,
	            pitch: 40,
		});
		map.setMapStyle('amap://styles/dcf80fea2c8eb7ef9cd2de3de6e4b080')
		//地图加载完成
		map.on("complete", function(){
		       log.success("地图加载完成！");
	}); 
	var marker = new AMap.Marker({
			position: new AMap.LngLat(106.610895,29.503814),   // 经纬度对象，也可以是经纬度构成的一维数组[116.39, 39.9]
			title: '重庆'
	});
	
	var threeLevel = getDataFunc();
	var lable =[];
		map.on('click', function(e) {
			document.getElementById("lnglat").value = e.lnglat.getLng() + ',' + e.lnglat.getLat()
		});
		var auto = new AMap.Autocomplete({
			input: "tipinput"
		});
		AMap.event.addListener(auto, "select", select);//注册监听，当选中某条记录时会触发
		function select(e) {
			if (e.poi && e.poi.location) {
				map.setCenter(e.poi.location);
			}
		}
		AMapUI.loadUI(['overlay/SimpleMarker'], function(SimpleMarker) {
				var la=[];
				for(var i=0;i<threeLevel.length;i++)
				{
					la[i]=String(i);
					new SimpleMarker({
						iconLabel: la[i],
						//自定义图标节点(img)的属性
						iconStyle: {
							src: 'https://webapi.amap.com/theme/v1.3/markers/b/mark_b.png',
							style: {
								width: '20px',
								height: '30px'
							}
						},
						//设置基点偏移
						offset: new AMap.Pixel(-10, -30),
						map: map,
						showPositionPoint: true,
						position: threeLevel[i],
						zIndex: 200
					});
				}
				var la1=[];
				for(var i=0;i<lable.length;i++)
				{
					la1[i]=String(i+1);
					new SimpleMarker({
						iconLabel: la1[i],
						//自定义图标节点(img)的属性
						iconStyle: {
							src: 'https://webapi.amap.com/theme/v1.3/markers/b/mark_r.png',
							style: {
								width: '20px',
								height: '30px'
							}
						},
						//设置基点偏移
						offset: new AMap.Pixel(-10, -30),
						map: map,
						showPositionPoint: true,
						position: lable[i],
						zIndex: 200
					});
				}		
			});
		AMapUI.load(['ui/misc/PathSimplifier', 'lib/$'], function(PathSimplifier, $) {

				if (!PathSimplifier.supportCanvas) {
					alert('当前环境不支持 Canvas！');
					return;
				}

				var pathSimplifierIns = new PathSimplifier({
					zIndex: 100,
					//autoSetFitView:false,
					map: map, //所属的地图实例

					getPath: function(pathData, pathIndex) {

						return pathData.path;
					},
					getHoverTitle: function(pathData, pathIndex, pointIndex) {
						if (pointIndex >= 0) {
							//point 
							return pathData.name + '，点：' + pointIndex + '/' + pathData.path.length;
						}
						return pathData.name + '，点数量' + pathData.path.length;
					},
					renderOptions: {

						renderAllPointsIfNumberBelow: 100 //绘制路线节点，如不需要可设置为-1
					}
				});
				window.onload = function() {
				new QWebChannel(qt.webChannelTransport, function(channel) {
					var content = channel.objects.content;
					content.sendText.connect(function(message) {
						Drawline(message);
						//alert(message);
						content.receiveText("true");
					});
				});
				}
				
				/*var arr="106.09021,29.872113\n106.080237,29.865127\n106.074401,29.863043\n106.066161,29.860065\n106.049681,29.854854\n106.041613,29.851877\n106.029425,29.842943\n106.025477,29.834903\n106.023074,29.827159\n106.018782,29.8215\n106.012088,29.808095\n106.008654,29.803478\n105.999556,29.796923\n105.98857,29.773831\n105.980845,29.764443\n105.97415,29.746858\n105.968829,29.74194\n105.963336,29.735828\n105.948401,29.717045\n105.937072,29.701539\n105.917846,29.679171\n105.913897,29.669774\n105.908931,29.653362";
				Drawline(arr);*/
				
				function Drawline(arr) {
					window.pathSimplifierIns = pathSimplifierIns;
					var colorsA=arr.split("\n")
					var path0_1=new Array();
					for(var i=0;i<colorsA.length;i++){
					    path0_1[i]=new Array(); 
					}
					for(var i=0;i<colorsA.length;i++)
					{
						var path=colorsA[i].split(",")
						path0_1[i][0]=path[0];
						path0_1[i][1]=path[1];
					}
					pathSimplifierIns.setData([{
						name: '路线1',
						path: path0_1
					}]);
					var dis0_1 = AMap.GeometryUtil.distanceOfLine(path0_1);
					//对第一条线路（即索引 0）创建一个巡航器
					
					var navg1 = pathSimplifierIns.createPathNavigator(0, {
									loop: false,
									speed: 50000,
									pathNavigatorStyle: {
										width: 20,
										height: 20,
										//使用图片
										/*content: PathSimplifier.Render.Canvas.getImageContent('https://webapi.amap.com/theme/v1.3/markers/b.png', onload, onerror),*/
										strokeStyle: 'blue',
										fillStyle: 'blue',
										//经过路径的样式
										disableIfSelected: false ,									
										pathLinePassedStyle: {
											lineWidth: 10,
											strokeStyle: 'blue',
											dirArrowStyle: {
												stepSpace: 15,
												strokeStyle: 'white'
											}
											
									}
									
									}
								});
					navg1.start()
				}
		});
		</script>
</body>
</html>

